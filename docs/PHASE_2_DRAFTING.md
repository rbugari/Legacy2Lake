# Phase 2: Drafting & Code Generation (Complete Guide)

## üìå Introduction
The **Drafting (Stage 2)** phase is the heart of automatic modernization in Legacy2Lake. Once triage has defined WHAT to migrate, this phase handles HOW to migrate it. We transform legacy logic into modern, clean, and executable code for the target cloud platform.

---

## üë®‚Äçüíª For the User: What do I get?
In this stage, you'll see your process mesh light up node-by-node as the AI generates code.

### Key Deliverables
1.  **Output Notebooks (.py/.sql):** Production-ready code including real connectivity (JDBC with Secret management), business logic as dataframes, and automatic patterns (SCD Type 2, Merge, etc.).
2.  **Audit Reports (.json):** Every script is accompanied by a "report card" generated by the Critic Agent, evaluating quality, security, and performance (Score 0-100).

---

## ‚öôÔ∏è Technical Architecture: The Generation Pipeline
Generation is an orchestrated multi-step process ensuring precision.

### 1. Topology Service
Deconstructs the original legacy package (e.g., SSIS) to extract SQL queries, map input/output types, and recognize logical patterns (Full vs. Incremental).

### 2. Migration Orchestrator
Package the context into structured "Task Definitions" for the agents, eliminating ambiguity.

### 3. Interpreter Agent (The Developer)
The target-tech expert. Applies the **Legacy2Lake Golden Rules**: absolute adherence to provided names, security-first connections, and standardized reading/writing formats.

### 4. Critic Agent (The Auditor)
Acts as a Senior Data Engineer. Validates logical correctness, audits platform compliance, and rejects any code that doesn't meet quality standards.

---

## üöÄ Featured Capabilities
- **Explicit Connectivity**: Automatically generates JDBC connection code using *Secret Scopes*.
- **SCD Type 2**: Automatic complex `MERGE` logic for historical dimensions.
- **Identity Management**: Implementation of sequential Surrogate Keys for Lakehouse integrity.

## üìä Typical Workflow
1.  **Approve Triage**: Lock the scope.
2.  **Execute Pipeline**: Start the migration from the Dashboard.
3.  **Monitoring**: Real-time progress via live logs.
4.  **Approve & Refine**: Transition to the Refinement phase once complete.

---
*Legacy2Lake Documentation Framework v2.0 - Stage 2*
